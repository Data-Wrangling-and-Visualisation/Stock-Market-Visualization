<!DOCTYPE html>
<html>
<head>
    <title>Modern MOEX Returns Heatmap</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      .nav-container {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }
        
        .nav-link {
            color: #2a9d8f;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .nav-link:hover {
            background: rgba(42, 157, 143, 0.1);
            transform: translateY(-1px);
        }

        .description {
            margin: 20px auto 40px;
            max-width: 800px;
            color: #495057;
            line-height: 1.6;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f8f9fa;
            margin: 2rem;
        }

        .controls {
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-left: 10%;
        }

        select {
            padding: 0.5rem;
            border-radius: 4px;
            border: 1px solid #dee2e6;
            background: white;
        }

        .heatmap-cell {
            transition: all 0.2s ease;
        }

        .heatmap-cell:hover {
            stroke: #212529;
            stroke-width: 2;
            filter: brightness(1.1);
        }

        #tooltip {
            position: absolute;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            pointer-events: none;
            font-size: 0.9rem;
            border: 1px solid #dee2e6;
        }

        .axis text {
            font-size: 0.8rem;
            fill: #495057;
        }

        .axis line {
            stroke: #dee2e6;
        }

        .chart-title {
            font-size: 1.5rem;
            font-weight: 600;
            fill: #212529;
        }
        svg {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="nav-container">
      <a href="/Stock-Market-Visualization/index.html" class="nav-link">← Back to Main</a>
    </div>

    <!-- Add description -->
    <div class="description">
        <h2>MOEX Investment Returns Matrix</h2>
        <p>This interactive heatmap visualizes the returns of MOEX index investments across different time periods. 
        Select a granularity (month/day) and date range to explore how returns vary between different investment horizons.
        Hover over cells to see exact return percentages and corresponding time periods. The color scale ranges from 
        red (negative returns) through white (neutral) to teal (positive returns).</p>
    </div>

    <div class="controls">
        <select id="granularity" onchange="updateControls()">
            <option value="month">Month</option>
            <option value="day">Day</option>
        </select>
        <select id="startRange"></select>
        <select id="endRange"></select>
    </div>
    <div id="heatmap"></div>
    <div id="tooltip"></div>

<script>
// Parse and sort data
const data = [
  {
    "date": "2024-09-20",
    "instrument_code": "TMOS",
    "sales": 128921.0,
    "volume_of_trade": 136418832.02,
    "mean_price": 5.93,
    "price_at_opening": 5.91,
    "min_price": 5.9,
    "max_price": 5.97,
    "price_at_closure": 5.93
  },
  {
    "date": "2024-09-19",
    "instrument_code": "TMOS",
    "sales": 121143.0,
    "volume_of_trade": 122696472.17,
    "mean_price": 5.88,
    "price_at_opening": 5.85,
    "min_price": 5.82,
    "max_price": 5.92,
    "price_at_closure": 5.89
  },
  {
    "date": "2024-09-18",
    "instrument_code": "TMOS",
    "sales": 119029.0,
    "volume_of_trade": 161996999.59,
    "mean_price": 5.87,
    "price_at_opening": 5.9,
    "min_price": 5.83,
    "max_price": 5.93,
    "price_at_closure": 5.87
  },
  {
    "date": "2024-09-17",
    "instrument_code": "TMOS",
    "sales": 129048.0,
    "volume_of_trade": 194823125.84,
    "mean_price": 5.87,
    "price_at_opening": 5.9,
    "min_price": 5.82,
    "max_price": 5.94,
    "price_at_closure": 5.9
  },
  {
    "date": "2024-09-16",
    "instrument_code": "TMOS",
    "sales": 187461.0,
    "volume_of_trade": 283924246.34,
    "mean_price": 5.81,
    "price_at_opening": 5.75,
    "min_price": 5.73,
    "max_price": 5.89,
    "price_at_closure": 5.84
  },
  {
    "date": "2024-09-13",
    "instrument_code": "TMOS",
    "sales": 134749.0,
    "volume_of_trade": 307604038.7,
    "mean_price": 5.62,
    "price_at_opening": 5.62,
    "min_price": 5.49,
    "max_price": 5.72,
    "price_at_closure": 5.7
  },
  {
    "date": "2024-09-12",
    "instrument_code": "TMOS",
    "sales": 121940.0,
    "volume_of_trade": 179368893.68,
    "mean_price": 5.59,
    "price_at_opening": 5.63,
    "min_price": 5.55,
    "max_price": 5.66,
    "price_at_closure": 5.59
  },
  {
    "date": "2024-09-11",
    "instrument_code": "TMOS",
    "sales": 118706.0,
    "volume_of_trade": 137084807.94,
    "mean_price": 5.7,
    "price_at_opening": 5.71,
    "min_price": 5.63,
    "max_price": 5.76,
    "price_at_closure": 5.7
  },
  {
    "date": "2024-09-10",
    "instrument_code": "TMOS",
    "sales": 121220.0,
    "volume_of_trade": 151706952.13,
    "mean_price": 5.73,
    "price_at_opening": 5.77,
    "min_price": 5.67,
    "max_price": 5.8,
    "price_at_closure": 5.71
  },
  {
    "date": "2024-09-09",
    "instrument_code": "TMOS",
    "sales": 191438.0,
    "volume_of_trade": 202209572.08,
    "mean_price": 5.7,
    "price_at_opening": 5.61,
    "min_price": 5.61,
    "max_price": 5.78,
    "price_at_closure": 5.75
  },
  {
    "date": "2024-09-06",
    "instrument_code": "TMOS",
    "sales": 123721.0,
    "volume_of_trade": 129888039.38,
    "mean_price": 5.58,
    "price_at_opening": 5.56,
    "min_price": 5.53,
    "max_price": 5.62,
    "price_at_closure": 5.59
  },
  {
    "date": "2024-09-05",
    "instrument_code": "TMOS",
    "sales": 122546.0,
    "volume_of_trade": 171919880.0,
    "mean_price": 5.6,
    "price_at_opening": 5.58,
    "min_price": 5.54,
    "max_price": 5.66,
    "price_at_closure": 5.58
  },
  {
    "date": "2024-09-04",
    "instrument_code": "TMOS",
    "sales": 122399.0,
    "volume_of_trade": 194465470.07,
    "mean_price": 5.5,
    "price_at_opening": 5.41,
    "min_price": 5.41,
    "max_price": 5.59,
    "price_at_closure": 5.55
  },
  {
    "date": "2024-09-03",
    "instrument_code": "TMOS",
    "sales": 130410.0,
    "volume_of_trade": 280331829.19,
    "mean_price": 5.47,
    "price_at_opening": 5.44,
    "min_price": 5.37,
    "max_price": 5.56,
    "price_at_closure": 5.41
  },
  {
    "date": "2024-09-02",
    "instrument_code": "TMOS",
    "sales": 183359.0,
    "volume_of_trade": 379973403.45,
    "mean_price": 5.51,
    "price_at_opening": 5.61,
    "min_price": 5.4,
    "max_price": 5.62,
    "price_at_closure": 5.46
  },
  {
    "date": "2024-08-30",
    "instrument_code": "TMOS",
    "sales": 127589.0,
    "volume_of_trade": 285410289.25,
    "mean_price": 5.69,
    "price_at_opening": 5.79,
    "min_price": 5.6,
    "max_price": 5.81,
    "price_at_closure": 5.65
  },
  {
    "date": "2024-08-29",
    "instrument_code": "TMOS",
    "sales": 116618.0,
    "volume_of_trade": 159238960.85,
    "mean_price": 5.77,
    "price_at_opening": 5.8,
    "min_price": 5.73,
    "max_price": 5.83,
    "price_at_closure": 5.78
  },
  {
    "date": "2024-08-28",
    "instrument_code": "TMOS",
    "sales": 127716.0,
    "volume_of_trade": 255174662.88,
    "mean_price": 5.75,
    "price_at_opening": 5.86,
    "min_price": 5.68,
    "max_price": 5.86,
    "price_at_closure": 5.76
  },
  {
    "date": "2024-08-27",
    "instrument_code": "TMOS",
    "sales": 123221.0,
    "volume_of_trade": 125960814.03,
    "mean_price": 5.88,
    "price_at_opening": 5.95,
    "min_price": 5.81,
    "max_price": 5.96,
    "price_at_closure": 5.84
  },
  {
    "date": "2024-08-26",
    "instrument_code": "TMOS",
    "sales": 190370.0,
    "volume_of_trade": 346879180.88,
    "mean_price": 5.88,
    "price_at_opening": 5.9,
    "min_price": 5.8,
    "max_price": 5.95,
    "price_at_closure": 5.88
  },
  {
    "date": "2025-02-28",
    "instrument_code": "TMOS",
    "sales": 120123.0,
    "volume_of_trade": 392341663.67,
    "mean_price": 7.0,
    "price_at_opening": 7.01,
    "min_price": 6.9,
    "max_price": 7.11,
    "price_at_closure": 7.02
  },
  {
    "date": "2025-02-27",
    "instrument_code": "TMOS",
    "sales": 175519.0,
    "volume_of_trade": 352012629.23,
    "mean_price": 7.05,
    "price_at_opening": 7.13,
    "min_price": 6.96,
    "max_price": 7.17,
    "price_at_closure": 7.07
  },
  {
    "date": "2025-02-26",
    "instrument_code": "TMOS",
    "sales": 251786.0,
    "volume_of_trade": 461285940.72,
    "mean_price": 7.17,
    "price_at_opening": 7.33,
    "min_price": 7.09,
    "max_price": 7.33,
    "price_at_closure": 7.17
  },
  {
    "date": "2025-02-25",
    "instrument_code": "TMOS",
    "sales": 191910.0,
    "volume_of_trade": 298028131.0,
    "mean_price": 7.34,
    "price_at_opening": 7.37,
    "min_price": 7.28,
    "max_price": 7.39,
    "price_at_closure": 7.28
  },
  {
    "date": "2025-02-24",
    "instrument_code": "TMOS",
    "sales": 196055.0,
    "volume_of_trade": 331606622.7,
    "mean_price": 7.25,
    "price_at_opening": 7.24,
    "min_price": 7.19,
    "max_price": 7.33,
    "price_at_closure": 7.24
  },
  {
    "date": "2025-02-21",
    "instrument_code": "TMOS",
    "sales": 133970.0,
    "volume_of_trade": 240262878.69,
    "mean_price": 7.21,
    "price_at_opening": 7.25,
    "min_price": 7.14,
    "max_price": 7.28,
    "price_at_closure": 7.21
  },
  {
    "date": "2025-02-20",
    "instrument_code": "TMOS",
    "sales": 143525.0,
    "volume_of_trade": 260725669.37,
    "mean_price": 7.23,
    "price_at_opening": 7.22,
    "min_price": 7.16,
    "max_price": 7.29,
    "price_at_closure": 7.22
  },
  {
    "date": "2025-02-19",
    "instrument_code": "TMOS",
    "sales": 149130.0,
    "volume_of_trade": 287657788.83,
    "mean_price": 7.16,
    "price_at_opening": 7.19,
    "min_price": 7.07,
    "max_price": 7.24,
    "price_at_closure": 7.15
  },
  {
    "date": "2025-02-18",
    "instrument_code": "TMOS",
    "sales": 135368.0,
    "volume_of_trade": 472165774.74,
    "mean_price": 7.19,
    "price_at_opening": 7.3,
    "min_price": 7.07,
    "max_price": 7.32,
    "price_at_closure": 7.16
  },
  {
    "date": "2025-02-17",
    "instrument_code": "TMOS",
    "sales": 278393.0,
    "volume_of_trade": 498341941.65,
    "mean_price": 7.19,
    "price_at_opening": 7.12,
    "min_price": 7.11,
    "max_price": 7.34,
    "price_at_closure": 7.24
  },
  {
    "date": "2025-02-14",
    "instrument_code": "TMOS",
    "sales": 209805.0,
    "volume_of_trade": 674710451.0,
    "mean_price": 7.08,
    "price_at_opening": 7.09,
    "min_price": 6.88,
    "max_price": 7.19,
    "price_at_closure": 6.97
  },
  {
    "date": "2025-02-13",
    "instrument_code": "TMOS",
    "sales": 104822.0,
    "volume_of_trade": 520085095.56,
    "mean_price": 7.01,
    "price_at_opening": 7.15,
    "min_price": 6.85,
    "max_price": 7.15,
    "price_at_closure": 7.0
  },
  {
    "date": "2025-02-12",
    "instrument_code": "TMOS",
    "sales": 196708.0,
    "volume_of_trade": 713268984.24,
    "mean_price": 6.84,
    "price_at_opening": 6.66,
    "min_price": 6.61,
    "max_price": 7.05,
    "price_at_closure": 6.63
  },
  {
    "date": "2025-02-11",
    "instrument_code": "TMOS",
    "sales": 100331.0,
    "volume_of_trade": 195035496.07,
    "mean_price": 6.58,
    "price_at_opening": 6.53,
    "min_price": 6.51,
    "max_price": 6.64,
    "price_at_closure": 6.59
  },
  {
    "date": "2025-02-10",
    "instrument_code": "TMOS",
    "sales": 163451.0,
    "volume_of_trade": 248650537.19,
    "mean_price": 6.55,
    "price_at_opening": 6.53,
    "min_price": 6.48,
    "max_price": 6.6,
    "price_at_closure": 6.57
  },
  {
    "date": "2025-02-07",
    "instrument_code": "TMOS",
    "sales": 89634.0,
    "volume_of_trade": 85265786.96,
    "mean_price": 6.49,
    "price_at_opening": 6.53,
    "min_price": 6.47,
    "max_price": 6.53,
    "price_at_closure": 6.47
  },
  {
    "date": "2025-02-06",
    "instrument_code": "TMOS",
    "sales": 89248.0,
    "volume_of_trade": 165708459.77,
    "mean_price": 6.49,
    "price_at_opening": 6.47,
    "min_price": 6.44,
    "max_price": 6.52,
    "price_at_closure": 6.51
  },
  {
    "date": "2025-02-05",
    "instrument_code": "TMOS",
    "sales": 100378.0,
    "volume_of_trade": 256407818.52,
    "mean_price": 6.38,
    "price_at_opening": 6.36,
    "min_price": 6.33,
    "max_price": 6.46,
    "price_at_closure": 6.41
  },
  {
    "date": "2025-02-04",
    "instrument_code": "TMOS",
    "sales": 83148.0,
    "volume_of_trade": 122197969.13,
    "mean_price": 6.41,
    "price_at_opening": 6.45,
    "min_price": 6.36,
    "max_price": 6.48,
    "price_at_closure": 6.38
  },
  {
    "date": "2025-02-03",
    "instrument_code": "TMOS",
    "sales": 142627.0,
    "volume_of_trade": 152156246.73,
    "mean_price": 6.42,
    "price_at_opening": 6.45,
    "min_price": 6.38,
    "max_price": 6.45,
    "price_at_closure": 6.41
  },
  {
    "date": "2025-01-31",
    "instrument_code": "TMOS",
    "sales": 96249.0,
    "volume_of_trade": 198039989.49,
    "mean_price": 6.5,
    "price_at_opening": 6.51,
    "min_price": 6.44,
    "max_price": 6.54,
    "price_at_closure": 6.46
  },
  {
    "date": "2025-01-30",
    "instrument_code": "TMOS",
    "sales": 95427.0,
    "volume_of_trade": 123784962.56,
    "mean_price": 6.46,
    "price_at_opening": 6.44,
    "min_price": 6.43,
    "max_price": 6.49,
    "price_at_closure": 6.48
  },
  {
    "date": "2025-01-29",
    "instrument_code": "TMOS",
    "sales": 99787.0,
    "volume_of_trade": 130569936.11,
    "mean_price": 6.43,
    "price_at_opening": 6.41,
    "min_price": 6.38,
    "max_price": 6.46,
    "price_at_closure": 6.43
  },
  {
    "date": "2025-01-28",
    "instrument_code": "TMOS",
    "sales": 106476.0,
    "volume_of_trade": 209923125.99,
    "mean_price": 6.34,
    "price_at_opening": 6.33,
    "min_price": 6.28,
    "max_price": 6.42,
    "price_at_closure": 6.41
  },
  {
    "date": "2025-01-27",
    "instrument_code": "TMOS",
    "sales": 145758.0,
    "volume_of_trade": 204756840.91,
    "mean_price": 6.37,
    "price_at_opening": 6.45,
    "min_price": 6.31,
    "max_price": 6.45,
    "price_at_closure": 6.33
  },
  {
    "date": "2025-01-24",
    "instrument_code": "TMOS",
    "sales": 105073.0,
    "volume_of_trade": 184158400.68,
    "mean_price": 6.45,
    "price_at_opening": 6.44,
    "min_price": 6.41,
    "max_price": 6.48,
    "price_at_closure": 6.45
  },
  {
    "date": "2025-01-23",
    "instrument_code": "TMOS",
    "sales": 95060.0,
    "volume_of_trade": 238726897.35,
    "mean_price": 6.37,
    "price_at_opening": 6.42,
    "min_price": 6.17,
    "max_price": 6.45,
    "price_at_closure": 6.37
  },
  {
    "date": "2025-01-22",
    "instrument_code": "TMOS",
    "sales": 91165.0,
    "volume_of_trade": 198259387.81,
    "mean_price": 6.45,
    "price_at_opening": 6.42,
    "min_price": 6.38,
    "max_price": 6.5,
    "price_at_closure": 6.48
  },
  {
    "date": "2025-01-21",
    "instrument_code": "TMOS",
    "sales": 93376.0,
    "volume_of_trade": 201763449.39,
    "mean_price": 6.37,
    "price_at_opening": 6.37,
    "min_price": 6.3,
    "max_price": 6.43,
    "price_at_closure": 6.41
  },
  {
    "date": "2025-01-20",
    "instrument_code": "TMOS",
    "sales": 184288.0,
    "volume_of_trade": 569780379.24,
    "mean_price": 6.44,
    "price_at_opening": 6.5,
    "min_price": 6.33,
    "max_price": 6.54,
    "price_at_closure": 6.4
  },
  {
    "date": "2025-01-17",
    "instrument_code": "TMOS",
    "sales": 108335.0,
    "volume_of_trade": 193618685.51,
    "mean_price": 6.4,
    "price_at_opening": 6.36,
    "min_price": 6.31,
    "max_price": 6.45,
    "price_at_closure": 6.43
  },
  {
    "date": "2025-01-16",
    "instrument_code": "TMOS",
    "sales": 106573.0,
    "volume_of_trade": 283051883.32,
    "mean_price": 6.35,
    "price_at_opening": 6.34,
    "min_price": 6.31,
    "max_price": 6.4,
    "price_at_closure": 6.36
  },
  {
    "date": "2025-01-15",
    "instrument_code": "TMOS",
    "sales": 123562.0,
    "volume_of_trade": 282211308.2,
    "mean_price": 6.25,
    "price_at_opening": 6.26,
    "min_price": 6.2,
    "max_price": 6.34,
    "price_at_closure": 6.22
  },
  {
    "date": "2025-01-14",
    "instrument_code": "TMOS",
    "sales": 93430.0,
    "volume_of_trade": 178349506.28,
    "mean_price": 6.23,
    "price_at_opening": 6.22,
    "min_price": 6.16,
    "max_price": 6.29,
    "price_at_closure": 6.25
  },
  {
    "date": "2025-01-13",
    "instrument_code": "TMOS",
    "sales": 173023.0,
    "volume_of_trade": 464149698.43,
    "mean_price": 6.24,
    "price_at_opening": 6.24,
    "min_price": 6.18,
    "max_price": 6.29,
    "price_at_closure": 6.25
  },
  {
    "date": "2025-01-10",
    "instrument_code": "TMOS",
    "sales": 155888.0,
    "volume_of_trade": 251783339.92,
    "mean_price": 6.11,
    "price_at_opening": 6.06,
    "min_price": 6.01,
    "max_price": 6.2,
    "price_at_closure": 6.15
  },
  {
    "date": "2025-01-09",
    "instrument_code": "TMOS",
    "sales": 125855.0,
    "volume_of_trade": 166142983.33,
    "mean_price": 6.1,
    "price_at_opening": 6.19,
    "min_price": 6.02,
    "max_price": 6.22,
    "price_at_closure": 6.05
  },
  {
    "date": "2025-01-08",
    "instrument_code": "TMOS",
    "sales": 132769.0,
    "volume_of_trade": 122851425.54,
    "mean_price": 6.18,
    "price_at_opening": 6.12,
    "min_price": 6.11,
    "max_price": 6.22,
    "price_at_closure": 6.2
  },
  {
    "date": "2025-01-06",
    "instrument_code": "TMOS",
    "sales": 137455.0,
    "volume_of_trade": 178124576.64,
    "mean_price": 6.12,
    "price_at_opening": 6.12,
    "min_price": 6.05,
    "max_price": 6.16,
    "price_at_closure": 6.15
  },
  {
    "date": "2025-01-03",
    "instrument_code": "TMOS",
    "sales": 178212.0,
    "volume_of_trade": 261850793.57,
    "mean_price": 6.18,
    "price_at_opening": 6.31,
    "min_price": 6.1,
    "max_price": 6.31,
    "price_at_closure": 6.15
  },
  {
    "date": "2024-12-30",
    "instrument_code": "TMOS",
    "sales": 290209.0,
    "volume_of_trade": 336701461.93,
    "mean_price": 6.2,
    "price_at_opening": 6.13,
    "min_price": 6.1,
    "max_price": 6.28,
    "price_at_closure": 6.25
  },
  {
    "date": "2024-12-28",
    "instrument_code": "TMOS",
    "sales": 131843.0,
    "volume_of_trade": 225343622.57,
    "mean_price": 6.07,
    "price_at_opening": 6.01,
    "min_price": 6.01,
    "max_price": 6.11,
    "price_at_closure": 6.07
  },
  {
    "date": "2024-12-27",
    "instrument_code": "TMOS",
    "sales": 113237.0,
    "volume_of_trade": 174481903.92,
    "mean_price": 5.99,
    "price_at_opening": 5.98,
    "min_price": 5.97,
    "max_price": 6.02,
    "price_at_closure": 6.0
  },
  {
    "date": "2024-12-26",
    "instrument_code": "TMOS",
    "sales": 110950.0,
    "volume_of_trade": 288455997.68,
    "mean_price": 5.99,
    "price_at_opening": 6.0,
    "min_price": 5.96,
    "max_price": 6.03,
    "price_at_closure": 6.0
  },
  {
    "date": "2024-12-25",
    "instrument_code": "TMOS",
    "sales": 110684.0,
    "volume_of_trade": 304361069.7,
    "mean_price": 5.9,
    "price_at_opening": 5.84,
    "min_price": 5.62,
    "max_price": 5.99,
    "price_at_closure": 5.94
  },
  {
    "date": "2024-12-24",
    "instrument_code": "TMOS",
    "sales": 102861.0,
    "volume_of_trade": 193099028.99,
    "mean_price": 5.87,
    "price_at_opening": 5.93,
    "min_price": 5.82,
    "max_price": 5.95,
    "price_at_closure": 5.87
  },
  {
    "date": "2024-12-23",
    "instrument_code": "TMOS",
    "sales": 223120.0,
    "volume_of_trade": 420801497.74,
    "mean_price": 5.89,
    "price_at_opening": 5.77,
    "min_price": 5.75,
    "max_price": 6.0,
    "price_at_closure": 5.88
  },
  {
    "date": "2024-12-20",
    "instrument_code": "TMOS",
    "sales": 142521.0,
    "volume_of_trade": 931698102.46,
    "mean_price": 5.51,
    "price_at_opening": 5.3,
    "min_price": 5.29,
    "max_price": 5.78,
    "price_at_closure": 5.74
  },
  {
    "date": "2024-12-19",
    "instrument_code": "TMOS",
    "sales": 98396.0,
    "volume_of_trade": 132906114.19,
    "mean_price": 5.33,
    "price_at_opening": 5.31,
    "min_price": 5.27,
    "max_price": 5.38,
    "price_at_closure": 5.28
  },
  {
    "date": "2024-12-18",
    "instrument_code": "TMOS",
    "sales": 98044.0,
    "volume_of_trade": 135181440.67,
    "mean_price": 5.26,
    "price_at_opening": 5.25,
    "min_price": 5.2,
    "max_price": 5.32,
    "price_at_closure": 5.26
  },
  {
    "date": "2024-12-17",
    "instrument_code": "TMOS",
    "sales": 117601.0,
    "volume_of_trade": 160689466.36,
    "mean_price": 5.23,
    "price_at_opening": 5.21,
    "min_price": 5.19,
    "max_price": 5.29,
    "price_at_closure": 5.22
  },
  {
    "date": "2024-12-16",
    "instrument_code": "TMOS",
    "sales": 160299.0,
    "volume_of_trade": 211858084.3,
    "mean_price": 5.27,
    "price_at_opening": 5.33,
    "min_price": 5.2,
    "max_price": 5.34,
    "price_at_closure": 5.23
  },
  {
    "date": "2024-12-13",
    "instrument_code": "TMOS",
    "sales": 107417.0,
    "volume_of_trade": 116510152.99,
    "mean_price": 5.33,
    "price_at_opening": 5.34,
    "min_price": 5.3,
    "max_price": 5.36,
    "price_at_closure": 5.35
  },
  {
    "date": "2024-12-12",
    "instrument_code": "TMOS",
    "sales": 118630.0,
    "volume_of_trade": 136896020.76,
    "mean_price": 5.4,
    "price_at_opening": 5.43,
    "min_price": 5.33,
    "max_price": 5.46,
    "price_at_closure": 5.35
  },
  {
    "date": "2024-12-11",
    "instrument_code": "TMOS",
    "sales": 130591.0,
    "volume_of_trade": 128552992.34,
    "mean_price": 5.4,
    "price_at_opening": 5.4,
    "min_price": 5.35,
    "max_price": 5.44,
    "price_at_closure": 5.38
  },
  {
    "date": "2024-12-10",
    "instrument_code": "TMOS",
    "sales": 101689.0,
    "volume_of_trade": 139618645.4,
    "mean_price": 5.44,
    "price_at_opening": 5.53,
    "min_price": 5.4,
    "max_price": 5.53,
    "price_at_closure": 5.42
  },
  {
    "date": "2024-12-09",
    "instrument_code": "TMOS",
    "sales": 160906.0,
    "volume_of_trade": 141596220.1,
    "mean_price": 5.5,
    "price_at_opening": 5.52,
    "min_price": 5.45,
    "max_price": 5.55,
    "price_at_closure": 5.53
  },
  {
    "date": "2024-12-06",
    "instrument_code": "TMOS",
    "sales": 116609.0,
    "volume_of_trade": 156319985.18,
    "mean_price": 5.43,
    "price_at_opening": 5.42,
    "min_price": 5.38,
    "max_price": 5.48,
    "price_at_closure": 5.44
  },
  {
    "date": "2024-12-05",
    "instrument_code": "TMOS",
    "sales": 173448.0,
    "volume_of_trade": 254601591.93,
    "mean_price": 5.33,
    "price_at_opening": 5.32,
    "min_price": 5.24,
    "max_price": 5.44,
    "price_at_closure": 5.39
  },
  {
    "date": "2024-12-04",
    "instrument_code": "TMOS",
    "sales": 131971.0,
    "volume_of_trade": 188694038.98,
    "mean_price": 5.39,
    "price_at_opening": 5.44,
    "min_price": 5.28,
    "max_price": 5.5,
    "price_at_closure": 5.35
  },
  {
    "date": "2024-12-03",
    "instrument_code": "TMOS",
    "sales": 105936.0,
    "volume_of_trade": 151841597.72,
    "mean_price": 5.48,
    "price_at_opening": 5.56,
    "min_price": 5.42,
    "max_price": 5.58,
    "price_at_closure": 5.46
  },
  {
    "date": "2024-12-02",
    "instrument_code": "TMOS",
    "sales": 162602.0,
    "volume_of_trade": 114654572.41,
    "mean_price": 5.57,
    "price_at_opening": 5.55,
    "min_price": 5.53,
    "max_price": 5.61,
    "price_at_closure": 5.56
  },
  {
    "date": "2024-11-29",
    "instrument_code": "TMOS",
    "sales": 111180.0,
    "volume_of_trade": 142863531.27,
    "mean_price": 5.51,
    "price_at_opening": 5.46,
    "min_price": 5.43,
    "max_price": 5.54,
    "price_at_closure": 5.53
  },
  {
    "date": "2024-11-28",
    "instrument_code": "TMOS",
    "sales": 109423.0,
    "volume_of_trade": 163285179.33,
    "mean_price": 5.44,
    "price_at_opening": 5.45,
    "min_price": 5.38,
    "max_price": 5.51,
    "price_at_closure": 5.47
  },
  {
    "date": "2024-11-27",
    "instrument_code": "TMOS",
    "sales": 121964.0,
    "volume_of_trade": 237178911.64,
    "mean_price": 5.33,
    "price_at_opening": 5.31,
    "min_price": 5.22,
    "max_price": 5.45,
    "price_at_closure": 5.38
  },
  {
    "date": "2024-11-26",
    "instrument_code": "TMOS",
    "sales": 122455.0,
    "volume_of_trade": 183888890.25,
    "mean_price": 5.37,
    "price_at_opening": 5.44,
    "min_price": 5.28,
    "max_price": 5.47,
    "price_at_closure": 5.3
  },
  {
    "date": "2024-11-25",
    "instrument_code": "TMOS",
    "sales": 174105.0,
    "volume_of_trade": 245046725.54,
    "mean_price": 5.47,
    "price_at_opening": 5.59,
    "min_price": 5.38,
    "max_price": 5.59,
    "price_at_closure": 5.43
  },
  {
    "date": "2024-11-22",
    "instrument_code": "TMOS",
    "sales": 120897.0,
    "volume_of_trade": 213184279.33,
    "mean_price": 5.58,
    "price_at_opening": 5.63,
    "min_price": 5.53,
    "max_price": 5.65,
    "price_at_closure": 5.55
  },
  {
    "date": "2024-11-21",
    "instrument_code": "TMOS",
    "sales": 158473.0,
    "volume_of_trade": 228206171.57,
    "mean_price": 5.54,
    "price_at_opening": 5.59,
    "min_price": 5.48,
    "max_price": 5.62,
    "price_at_closure": 5.51
  },
  {
    "date": "2024-11-20",
    "instrument_code": "TMOS",
    "sales": 109178.0,
    "volume_of_trade": 191594855.99,
    "mean_price": 5.65,
    "price_at_opening": 5.68,
    "min_price": 5.55,
    "max_price": 5.72,
    "price_at_closure": 5.59
  },
  {
    "date": "2024-11-19",
    "instrument_code": "TMOS",
    "sales": 108732.0,
    "volume_of_trade": 172354388.18,
    "mean_price": 5.71,
    "price_at_opening": 5.8,
    "min_price": 5.62,
    "max_price": 5.83,
    "price_at_closure": 5.65
  },
  {
    "date": "2024-11-18",
    "instrument_code": "TMOS",
    "sales": 175590.0,
    "volume_of_trade": 211133155.86,
    "mean_price": 5.83,
    "price_at_opening": 5.82,
    "min_price": 5.77,
    "max_price": 5.88,
    "price_at_closure": 5.85
  },
  {
    "date": "2024-11-15",
    "instrument_code": "TMOS",
    "sales": 115492.0,
    "volume_of_trade": 151823401.27,
    "mean_price": 5.84,
    "price_at_opening": 5.8,
    "min_price": 5.78,
    "max_price": 5.92,
    "price_at_closure": 5.87
  },
  {
    "date": "2024-11-14",
    "instrument_code": "TMOS",
    "sales": 108065.0,
    "volume_of_trade": 140540042.43,
    "mean_price": 5.82,
    "price_at_opening": 5.82,
    "min_price": 5.76,
    "max_price": 5.88,
    "price_at_closure": 5.78
  },
  {
    "date": "2024-11-13",
    "instrument_code": "TMOS",
    "sales": 124370.0,
    "volume_of_trade": 131947732.93,
    "mean_price": 5.91,
    "price_at_opening": 5.89,
    "min_price": 5.83,
    "max_price": 5.95,
    "price_at_closure": 5.94
  },
  {
    "date": "2024-11-12",
    "instrument_code": "TMOS",
    "sales": 106649.0,
    "volume_of_trade": 133762384.89,
    "mean_price": 5.93,
    "price_at_opening": 5.97,
    "min_price": 5.89,
    "max_price": 5.99,
    "price_at_closure": 5.92
  },
  {
    "date": "2024-11-11",
    "instrument_code": "TMOS",
    "sales": 194512.0,
    "volume_of_trade": 202306339.9,
    "mean_price": 5.98,
    "price_at_opening": 6.0,
    "min_price": 5.93,
    "max_price": 6.02,
    "price_at_closure": 5.99
  },
  {
    "date": "2024-11-08",
    "instrument_code": "TMOS",
    "sales": 174857.0,
    "volume_of_trade": 223680078.19,
    "mean_price": 5.87,
    "price_at_opening": 5.9,
    "min_price": 5.82,
    "max_price": 5.96,
    "price_at_closure": 5.86
  },
  {
    "date": "2024-11-07",
    "instrument_code": "TMOS",
    "sales": 131190.0,
    "volume_of_trade": 161175488.47,
    "mean_price": 5.72,
    "price_at_opening": 5.71,
    "min_price": 5.66,
    "max_price": 5.85,
    "price_at_closure": 5.76
  },
  {
    "date": "2024-11-06",
    "instrument_code": "TMOS",
    "sales": 128574.0,
    "volume_of_trade": 319439787.5,
    "mean_price": 5.76,
    "price_at_opening": 5.81,
    "min_price": 5.63,
    "max_price": 5.85,
    "price_at_closure": 5.72
  },
  {
    "date": "2024-11-05",
    "instrument_code": "TMOS",
    "sales": 170111.0,
    "volume_of_trade": 137443726.15,
    "mean_price": 5.61,
    "price_at_opening": 5.61,
    "min_price": 5.57,
    "max_price": 5.63,
    "price_at_closure": 5.62
  },
  {
    "date": "2024-11-02",
    "instrument_code": "TMOS",
    "sales": 107881.0,
    "volume_of_trade": 72562133.61,
    "mean_price": 5.55,
    "price_at_opening": 5.54,
    "min_price": 5.52,
    "max_price": 5.59,
    "price_at_closure": 5.57
  },
  {
    "date": "2024-11-01",
    "instrument_code": "TMOS",
    "sales": 123840.0,
    "volume_of_trade": 151517002.15,
    "mean_price": 5.5,
    "price_at_opening": 5.48,
    "min_price": 5.46,
    "max_price": 5.54,
    "price_at_closure": 5.52
  },
  {
    "date": "2024-10-31",
    "instrument_code": "TMOS",
    "sales": 122510.0,
    "volume_of_trade": 160950606.17,
    "mean_price": 5.51,
    "price_at_opening": 5.52,
    "min_price": 5.47,
    "max_price": 5.56,
    "price_at_closure": 5.5
  },
  {
    "date": "2024-10-30",
    "instrument_code": "TMOS",
    "sales": 116831.0,
    "volume_of_trade": 146647563.07,
    "mean_price": 5.59,
    "price_at_opening": 5.59,
    "min_price": 5.52,
    "max_price": 5.64,
    "price_at_closure": 5.62
  },
  {
    "date": "2024-10-29",
    "instrument_code": "TMOS",
    "sales": 139068.0,
    "volume_of_trade": 184852739.59,
    "mean_price": 5.56,
    "price_at_opening": 5.54,
    "min_price": 5.48,
    "max_price": 5.62,
    "price_at_closure": 5.58
  },
  {
    "date": "2024-10-28",
    "instrument_code": "TMOS",
    "sales": 194554.0,
    "volume_of_trade": 268390812.02,
    "mean_price": 5.61,
    "price_at_opening": 5.7,
    "min_price": 5.49,
    "max_price": 5.7,
    "price_at_closure": 5.51
  },
  {
    "date": "2024-10-25",
    "instrument_code": "TMOS",
    "sales": 150667.0,
    "volume_of_trade": 241306634.32,
    "mean_price": 5.81,
    "price_at_opening": 5.84,
    "min_price": 5.7,
    "max_price": 5.91,
    "price_at_closure": 5.73
  },
  {
    "date": "2024-10-24",
    "instrument_code": "TMOS",
    "sales": 105213.0,
    "volume_of_trade": 99188084.8,
    "mean_price": 5.81,
    "price_at_opening": 5.83,
    "min_price": 5.77,
    "max_price": 5.85,
    "price_at_closure": 5.83
  },
  {
    "date": "2024-10-23",
    "instrument_code": "TMOS",
    "sales": 111351.0,
    "volume_of_trade": 112827511.12,
    "mean_price": 5.88,
    "price_at_opening": 5.92,
    "min_price": 5.83,
    "max_price": 5.92,
    "price_at_closure": 5.87
  },
  {
    "date": "2024-10-22",
    "instrument_code": "TMOS",
    "sales": 103956.0,
    "volume_of_trade": 110132663.74,
    "mean_price": 5.94,
    "price_at_opening": 5.95,
    "min_price": 5.9,
    "max_price": 5.97,
    "price_at_closure": 5.93
  },
  {
    "date": "2024-10-21",
    "instrument_code": "TMOS",
    "sales": 162512.0,
    "volume_of_trade": 137772727.1,
    "mean_price": 5.96,
    "price_at_opening": 5.92,
    "min_price": 5.92,
    "max_price": 5.98,
    "price_at_closure": 5.94
  },
  {
    "date": "2024-10-18",
    "instrument_code": "TMOS",
    "sales": 117582.0,
    "volume_of_trade": 100318357.36,
    "mean_price": 5.93,
    "price_at_opening": 5.95,
    "min_price": 5.9,
    "max_price": 5.97,
    "price_at_closure": 5.93
  },
  {
    "date": "2024-10-17",
    "instrument_code": "TMOS",
    "sales": 124249.0,
    "volume_of_trade": 149920973.21,
    "mean_price": 5.97,
    "price_at_opening": 6.0,
    "min_price": 5.94,
    "max_price": 6.0,
    "price_at_closure": 5.95
  },
  {
    "date": "2024-10-16",
    "instrument_code": "TMOS",
    "sales": 108598.0,
    "volume_of_trade": 146776327.63,
    "mean_price": 6.02,
    "price_at_opening": 6.02,
    "min_price": 5.96,
    "max_price": 6.06,
    "price_at_closure": 5.98
  },
  {
    "date": "2024-10-15",
    "instrument_code": "TMOS",
    "sales": 110764.0,
    "volume_of_trade": 118900675.47,
    "mean_price": 5.99,
    "price_at_opening": 5.96,
    "min_price": 5.93,
    "max_price": 6.03,
    "price_at_closure": 6.01
  },
  {
    "date": "2024-10-14",
    "instrument_code": "TMOS",
    "sales": 162676.0,
    "volume_of_trade": 180441743.84,
    "mean_price": 5.91,
    "price_at_opening": 5.9,
    "min_price": 5.84,
    "max_price": 5.98,
    "price_at_closure": 5.96
  },
  {
    "date": "2024-10-11",
    "instrument_code": "TMOS",
    "sales": 116377.0,
    "volume_of_trade": 82594924.94,
    "mean_price": 5.9,
    "price_at_opening": 5.94,
    "min_price": 5.87,
    "max_price": 5.94,
    "price_at_closure": 5.9
  },
  {
    "date": "2024-10-10",
    "instrument_code": "TMOS",
    "sales": 115933.0,
    "volume_of_trade": 102801196.43,
    "mean_price": 5.93,
    "price_at_opening": 5.95,
    "min_price": 5.9,
    "max_price": 5.96,
    "price_at_closure": 5.93
  },
  {
    "date": "2024-10-09",
    "instrument_code": "TMOS",
    "sales": 104878.0,
    "volume_of_trade": 91209325.37,
    "mean_price": 5.93,
    "price_at_opening": 5.99,
    "min_price": 5.9,
    "max_price": 5.99,
    "price_at_closure": 5.91
  },
  {
    "date": "2024-10-08",
    "instrument_code": "TMOS",
    "sales": 106391.0,
    "volume_of_trade": 92471159.88,
    "mean_price": 5.96,
    "price_at_opening": 5.98,
    "min_price": 5.93,
    "max_price": 6.0,
    "price_at_closure": 5.96
  },
  {
    "date": "2024-10-07",
    "instrument_code": "TMOS",
    "sales": 161649.0,
    "volume_of_trade": 196046919.23,
    "mean_price": 5.96,
    "price_at_opening": 5.98,
    "min_price": 5.91,
    "max_price": 6.03,
    "price_at_closure": 5.94
  },
  {
    "date": "2024-10-04",
    "instrument_code": "TMOS",
    "sales": 117370.0,
    "volume_of_trade": 127040645.04,
    "mean_price": 5.98,
    "price_at_opening": 5.95,
    "min_price": 5.94,
    "max_price": 6.02,
    "price_at_closure": 5.98
  },
  {
    "date": "2024-10-03",
    "instrument_code": "TMOS",
    "sales": 130120.0,
    "volume_of_trade": 209118930.43,
    "mean_price": 5.89,
    "price_at_opening": 5.9,
    "min_price": 5.84,
    "max_price": 5.96,
    "price_at_closure": 5.94
  },
  {
    "date": "2024-10-02",
    "instrument_code": "TMOS",
    "sales": 115968.0,
    "volume_of_trade": 136457957.92,
    "mean_price": 5.97,
    "price_at_opening": 6.02,
    "min_price": 5.85,
    "max_price": 6.05,
    "price_at_closure": 5.89
  },
  {
    "date": "2024-10-01",
    "instrument_code": "TMOS",
    "sales": 118569.0,
    "volume_of_trade": 197414983.04,
    "mean_price": 5.99,
    "price_at_opening": 6.03,
    "min_price": 5.95,
    "max_price": 6.06,
    "price_at_closure": 6.0
  },
  {
    "date": "2024-09-30",
    "instrument_code": "TMOS",
    "sales": 173509.0,
    "volume_of_trade": 194513716.69,
    "mean_price": 6.1,
    "price_at_opening": 6.12,
    "min_price": 6.01,
    "max_price": 6.15,
    "price_at_closure": 6.08
  },
  {
    "date": "2024-09-27",
    "instrument_code": "TMOS",
    "sales": 126065.0,
    "volume_of_trade": 176551356.56,
    "mean_price": 6.06,
    "price_at_opening": 6.01,
    "min_price": 6.01,
    "max_price": 6.1,
    "price_at_closure": 6.09
  },
  {
    "date": "2024-09-26",
    "instrument_code": "TMOS",
    "sales": 125992.0,
    "volume_of_trade": 142970901.23,
    "mean_price": 6.01,
    "price_at_opening": 6.04,
    "min_price": 5.97,
    "max_price": 6.06,
    "price_at_closure": 6.03
  },
  {
    "date": "2024-09-25",
    "instrument_code": "TMOS",
    "sales": 118459.0,
    "volume_of_trade": 176049309.56,
    "mean_price": 6.08,
    "price_at_opening": 6.14,
    "min_price": 6.01,
    "max_price": 6.14,
    "price_at_closure": 6.04
  },
  {
    "date": "2024-09-24",
    "instrument_code": "TMOS",
    "sales": 121703.0,
    "volume_of_trade": 189042755.24,
    "mean_price": 6.08,
    "price_at_opening": 6.04,
    "min_price": 6.01,
    "max_price": 6.13,
    "price_at_closure": 6.1
  },
  {
    "date": "2024-09-23",
    "instrument_code": "TMOS",
    "sales": 193386.0,
    "volume_of_trade": 201418560.51,
    "mean_price": 6.0,
    "price_at_opening": 5.97,
    "min_price": 5.96,
    "max_price": 6.05,
    "price_at_closure": 6.01
  },
  {
    "date": "2024-09-20",
    "instrument_code": "TMOS",
    "sales": 128921.0,
    "volume_of_trade": 136418832.02,
    "mean_price": 5.93,
    "price_at_opening": 5.91,
    "min_price": 5.9,
    "max_price": 5.97,
    "price_at_closure": 5.93
  },
  {
    "date": "2024-09-19",
    "instrument_code": "TMOS",
    "sales": 121143.0,
    "volume_of_trade": 122696472.17,
    "mean_price": 5.88,
    "price_at_opening": 5.85,
    "min_price": 5.82,
    "max_price": 5.92,
    "price_at_closure": 5.89
  },
  {
    "date": "2024-09-18",
    "instrument_code": "TMOS",
    "sales": 119029.0,
    "volume_of_trade": 161996999.59,
    "mean_price": 5.87,
    "price_at_opening": 5.9,
    "min_price": 5.83,
    "max_price": 5.93,
    "price_at_closure": 5.87
  },
  {
    "date": "2024-09-17",
    "instrument_code": "TMOS",
    "sales": 129048.0,
    "volume_of_trade": 194823125.84,
    "mean_price": 5.87,
    "price_at_opening": 5.9,
    "min_price": 5.82,
    "max_price": 5.94,
    "price_at_closure": 5.9
  },
  {
    "date": "2024-09-16",
    "instrument_code": "TMOS",
    "sales": 187461.0,
    "volume_of_trade": 283924246.34,
    "mean_price": 5.81,
    "price_at_opening": 5.75,
    "min_price": 5.73,
    "max_price": 5.89,
    "price_at_closure": 5.84
  },
  {
    "date": "2024-09-13",
    "instrument_code": "TMOS",
    "sales": 134749.0,
    "volume_of_trade": 307604038.7,
    "mean_price": 5.62,
    "price_at_opening": 5.62,
    "min_price": 5.49,
    "max_price": 5.72,
    "price_at_closure": 5.7
  },
  {
    "date": "2024-09-12",
    "instrument_code": "TMOS",
    "sales": 121940.0,
    "volume_of_trade": 179368893.68,
    "mean_price": 5.59,
    "price_at_opening": 5.63,
    "min_price": 5.55,
    "max_price": 5.66,
    "price_at_closure": 5.59
  },
  {
    "date": "2024-09-11",
    "instrument_code": "TMOS",
    "sales": 118706.0,
    "volume_of_trade": 137084807.94,
    "mean_price": 5.7,
    "price_at_opening": 5.71,
    "min_price": 5.63,
    "max_price": 5.76,
    "price_at_closure": 5.7
  },
  {
    "date": "2024-09-10",
    "instrument_code": "TMOS",
    "sales": 121220.0,
    "volume_of_trade": 151706952.13,
    "mean_price": 5.73,
    "price_at_opening": 5.77,
    "min_price": 5.67,
    "max_price": 5.8,
    "price_at_closure": 5.71
  },
  {
    "date": "2024-09-09",
    "instrument_code": "TMOS",
    "sales": 191438.0,
    "volume_of_trade": 202209572.08,
    "mean_price": 5.7,
    "price_at_opening": 5.61,
    "min_price": 5.61,
    "max_price": 5.78,
    "price_at_closure": 5.75
  },
  {
    "date": "2024-09-06",
    "instrument_code": "TMOS",
    "sales": 123721.0,
    "volume_of_trade": 129888039.38,
    "mean_price": 5.58,
    "price_at_opening": 5.56,
    "min_price": 5.53,
    "max_price": 5.62,
    "price_at_closure": 5.59
  },
  {
    "date": "2024-09-05",
    "instrument_code": "TMOS",
    "sales": 122546.0,
    "volume_of_trade": 171919880.0,
    "mean_price": 5.6,
    "price_at_opening": 5.58,
    "min_price": 5.54,
    "max_price": 5.66,
    "price_at_closure": 5.58
  },
  {
    "date": "2024-09-04",
    "instrument_code": "TMOS",
    "sales": 122399.0,
    "volume_of_trade": 194465470.07,
    "mean_price": 5.5,
    "price_at_opening": 5.41,
    "min_price": 5.41,
    "max_price": 5.59,
    "price_at_closure": 5.55
  },
  {
    "date": "2024-09-03",
    "instrument_code": "TMOS",
    "sales": 130410.0,
    "volume_of_trade": 280331829.19,
    "mean_price": 5.47,
    "price_at_opening": 5.44,
    "min_price": 5.37,
    "max_price": 5.56,
    "price_at_closure": 5.41
  },
  {
    "date": "2024-09-02",
    "instrument_code": "TMOS",
    "sales": 183359.0,
    "volume_of_trade": 379973403.45,
    "mean_price": 5.51,
    "price_at_opening": 5.61,
    "min_price": 5.4,
    "max_price": 5.62,
    "price_at_closure": 5.46
  },
  {
    "date": "2024-08-30",
    "instrument_code": "TMOS",
    "sales": 127589.0,
    "volume_of_trade": 285410289.25,
    "mean_price": 5.69,
    "price_at_opening": 5.79,
    "min_price": 5.6,
    "max_price": 5.81,
    "price_at_closure": 5.65
  },
  {
    "date": "2024-08-29",
    "instrument_code": "TMOS",
    "sales": 116618.0,
    "volume_of_trade": 159238960.85,
    "mean_price": 5.77,
    "price_at_opening": 5.8,
    "min_price": 5.73,
    "max_price": 5.83,
    "price_at_closure": 5.78
  },
  {
    "date": "2024-08-28",
    "instrument_code": "TMOS",
    "sales": 127716.0,
    "volume_of_trade": 255174662.88,
    "mean_price": 5.75,
    "price_at_opening": 5.86,
    "min_price": 5.68,
    "max_price": 5.86,
    "price_at_closure": 5.76
  },
  {
    "date": "2024-08-27",
    "instrument_code": "TMOS",
    "sales": 123221.0,
    "volume_of_trade": 125960814.03,
    "mean_price": 5.88,
    "price_at_opening": 5.95,
    "min_price": 5.81,
    "max_price": 5.96,
    "price_at_closure": 5.84
  },
  {
    "date": "2024-08-26",
    "instrument_code": "TMOS",
    "sales": 190370.0,
    "volume_of_trade": 346879180.88,
    "mean_price": 5.88,
    "price_at_opening": 5.9,
    "min_price": 5.8,
    "max_price": 5.95,
    "price_at_closure": 5.88
  }
]; // Insert your JSON data here

let processedData = data.map(d => ({
    date: new Date(d.date),
    open: d.price_at_opening,
    close: d.price_at_closure
})).sort((a,b) => a.date - b.date);

// Initial setup
let granularity = 'month';
let periods = [];
let startRange, endRange;

function updateControls() {
    granularity = document.getElementById('granularity').value;
    processPeriods();
    populateRangeSelects();
    updateHeatmap();
}

function processPeriods() {
    const periodMap = new Map();
    
    processedData.forEach(d => {
        const key = granularity === 'month' 
            ? `${d.date.getFullYear()}-${String(d.date.getMonth() + 1).padStart(2, '0')}`
            : d.date.toISOString().split('T')[0];
        
        if (!periodMap.has(key)) {
            periodMap.set(key, {
                open: d.open,
                close: d.close,
                dates: [d.date]
            });
        } else {
            const period = periodMap.get(key);
            period.dates.push(d.date);
            period.close = d.close; // Keep last close price
        }
    });

    periods = Array.from(periodMap.entries())
        .sort((a,b) => new Date(a[0]) - new Date(b[0]))
        .map(([key, val]) => ({
            key,
            open: val.open,
            close: val.close
        }));
}

function populateRangeSelects() {
    const startSelect = document.getElementById('startRange');
    const endSelect = document.getElementById('endRange');
    
    startSelect.innerHTML = periods.map(p => `<option>${p.key}</option>`).join('');
    endSelect.innerHTML = periods.map(p => `<option>${p.key}</option>`).join('');
    
    startRange = periods[0].key;
    endRange = periods[periods.length-1].key;
}

function calculateReturns() {
    const returns = {};
    const startIdx = periods.findIndex(p => p.key === startRange);
    const endIdx = periods.findIndex(p => p.key === endRange);
    const filteredPeriods = periods.slice(startIdx, endIdx + 1);

    filteredPeriods.forEach((startPeriod, i) => {
        filteredPeriods.slice(i).forEach(endPeriod => {
            const returnVal = (endPeriod.close - startPeriod.open)/startPeriod.open;
            returns[`${startPeriod.key}_${endPeriod.key}`] = returnVal;
        });
    });
    
    return { returns, filteredPeriods };
}

function updateHeatmap() {
    const { returns, filteredPeriods } = calculateReturns();
    const cellSize = 45;
    const margin = { top: 100, right: 40, bottom: 100, left: 100 };
    
    d3.select("#heatmap").html('');
    const svg = d3.select("#heatmap")
        .append("svg")
        .attr("width", margin.left + filteredPeriods.length * cellSize + margin.right)
        .attr("height", margin.top + filteredPeriods.length * cellSize + margin.bottom);

    // Modern color scale
    const colorScale = d3.scaleLinear()
        .domain([d3.min(Object.values(returns)), 0, d3.max(Object.values(returns))])
        .range(["#e76f51", "#f8f9fa", "#2a9d8f"]);

    // Create cells
    filteredPeriods.forEach((startPeriod, i) => {
        filteredPeriods.slice(i).forEach((endPeriod, j) => {
            const returnVal = returns[`${startPeriod.key}_${endPeriod.key}`];
            
            svg.append("rect")
                .attr("class", "heatmap-cell")
                .attr("x", margin.left + i * cellSize)
                .attr("y", margin.top + j * cellSize)
                .attr("width", cellSize - 2)
                .attr("height", cellSize - 2)
                .attr("rx", 4) // Rounded corners
                .attr("fill", colorScale(returnVal))
                .on("mouseover", function(e) {
                  // Показ тултипа
                  d3.select("#tooltip")
                      .style("left", e.pageX + 15 + "px")
                      .style("top", e.pageY + 15 + "px")
                      .html(`
                          <strong>${startPeriod.key} → ${endPeriod.key}</strong><br>
                          Return: <span style="color:${returnVal >= 0 ? '#2a9d8f' : '#e76f51'}">${(returnVal*100).toFixed(1)}%</span>
                      `);

                      const currentStartIndex = i;
                    const relevantPeriods = filteredPeriods.slice(currentStartIndex);

                    // Обновить шкалу Y
                    const yAxisScale = d3.scaleBand()
                        .domain(relevantPeriods.map(p => p.key))
                        .range([margin.top, margin.top + relevantPeriods.length * cellSize]);

                    // Перерисовать ось Y
                    svg.select(".y-axis")
                        .transition()
                        .duration(300)
                        .call(d3.axisLeft(yAxisScale))
                        .selectAll("text")
                            .style("text-anchor", "end")
                            .attr("dx", "-1em");

                    // Показать тултип
                    d3.select("#tooltip")
                        .style("left", e.pageX + 15 + "px")
                        .style("top", e.pageY + 15 + "px")
                        .html(`
                            <strong>${startPeriod.key} → ${endPeriod.key}</strong><br>
                            Return: <span style="color:${returnVal >= 0 ? '#2a9d8f' : '#e76f51'}">${(returnVal*100).toFixed(1)}%</span>
                        `);
              })
              .on("mousemove", function(e) {
                  // Обновление позиции тултипа при движении курсора
                  d3.select("#tooltip")
                      .style("left", e.pageX + 15 + "px")
                      .style("top", e.pageY + 15 + "px");
              })
              .on("mouseleave", function() {
                  // Возврат к исходному состоянию
                  d3.select(this)
                      .transition()
                      .duration(100)
                      .attr("stroke-width", 0);

                  // Скрытие тултипа
                  d3.select("#tooltip").style("opacity", 0);

                  // Восстановить исходную ось Y
                  const yAxisScale = d3.scaleBand()
                        .domain(filteredPeriods.map(p => p.key))
                        .range([margin.top, margin.top + filteredPeriods.length * cellSize]);

                    svg.select(".y-axis")
                        .transition()
                        .duration(300)
                        .call(d3.axisLeft(yAxisScale));
              })
              .on("mouseenter", function() {
                  // Плавное появление тултипа
                  d3.select("#tooltip").style("opacity", 1);
              });
        });
    });

    // Add axes with rotated labels
    const axisScale = d3.scaleBand()
        .domain(filteredPeriods.map(p => p.key))
        .range([margin.left, margin.left + filteredPeriods.length * cellSize]);

    // X-axis
    svg.append("g")
        .attr("class", "x-axis")
        .attr("transform", `translate(0,${margin.top})`)
        .call(d3.axisTop(axisScale))
        .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-1.5em")
            .attr("dy", "1.3em")
            .attr("transform", "rotate(90)");

    const yAxisScale = d3.scaleBand()
        .domain(filteredPeriods.map(p => p.key))
        .range([margin.top, margin.top + filteredPeriods.length * cellSize]);
    // Y-axis
    svg.append("g")
        .attr("class", "y-axis")
        .attr("transform", `translate(${margin.left},0)`)
        .call(d3.axisLeft(yAxisScale))
        .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-1em")
            .attr("dy", "0em");

    // Add chart title
    svg.append("text")
        .attr("class", "chart-title")
        .attr("x", margin.left + filteredPeriods.length * cellSize / 2)
        .attr("y", 17)
        .attr("text-anchor", "middle")
        .text("MOEX Investment Returns Matrix");
}

// Initialization
processPeriods();
populateRangeSelects();
updateHeatmap();

// Event listeners
document.getElementById('startRange').addEventListener('change', function() {
    startRange = this.value;
    updateHeatmap();
});

document.getElementById('endRange').addEventListener('change', function() {
    endRange = this.value;
    updateHeatmap();
});
</script>
</body>
</html>